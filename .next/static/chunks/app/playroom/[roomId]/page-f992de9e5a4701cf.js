(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[488],{3934:function(e,l,s){Promise.resolve().then(s.bind(s,3927))},3927:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return el}});var t=s(7437);s(832);var r=s(1396),a=s.n(r),i=s(6691),c=s.n(i),n=s(2265),o={src:"/_next/static/media/VideoTag.64b5334d.svg",height:477,width:763,blurWidth:0,blurHeight:0},d={src:"/_next/static/media/LeftArrow.6dd47569.svg",height:40,width:17,blurWidth:0,blurHeight:0},m={src:"/_next/static/media/RightArrow.d977ca5e.svg",height:40,width:17,blurWidth:0,blurHeight:0};function u(e){let{streamManager:l}=e,s=(0,n.useRef)(null);return(0,n.useEffect)(()=>{l&&s.current&&l.addVideoElement(s.current)},[l]),(0,t.jsx)("video",{autoPlay:!0,ref:s,className:"z-10 w-full"})}function x(e){let{streamManager:l}=e;return(0,t.jsx)("div",{className:"z-10 w-full",children:void 0!==l?(0,t.jsxs)("div",{className:"z-10 w-full",children:[(0,t.jsx)(u,{streamManager:l}),(0,t.jsx)("div",{children:(0,t.jsx)("p",{children:JSON.parse(l.stream.connection.data).clientData})})]}):null})}function h(e){let[l,s]=(0,n.useState)(0),[r,a]=(0,n.useState)(e.subscribers),[i,u]=(0,n.useState)(e.call);return(0,t.jsx)("div",{className:"topcontainer",children:(0,t.jsxs)("div",{className:"top-1/2 left-1/2 mx-auto text-center w-full",children:[(0,t.jsxs)("p",{className:"my-10 text-3xl w-full",children:[e.depart,"의 ",e.title]}),(0,t.jsx)("div",{className:"flex flex-row w-8/9",children:(0,t.jsxs)("div",{className:"mx-auto flex flex-row space-x-10  w-full  ",children:[(0,t.jsx)(c(),{alt:"왼쪽 화살표",src:d,onClick:()=>{s(e=>e>0?e-1:e),console.log(l)},className:"w-1/18"}),(0,t.jsx)("div",{className:"flex flex-row space-x-4 overflow-x-hidden overflow-hidden w-full  ",children:e.subscribers.length>0?(0,t.jsx)("div",{className:" carousel ",style:{left:"-".concat(20*l,"%")},children:e.ENTRY.map((e,l)=>(0,t.jsx)("div",{className:"w-1/5 p-3",children:e.camera?(0,t.jsx)("div",{className:"",children:(0,t.jsx)(x,{streamManager:e.camera},l)}):(0,t.jsx)(c(),{src:o,className:" rounded",alt:"..."})},l))}):(0,t.jsxs)("div",{className:"mx-auto flex flex-row space-x-10  w-full ",children:[(0,t.jsx)(c(),{src:o,className:"max-w-96 rounded",alt:"..."}),(0,t.jsx)(c(),{src:o,className:"max-w-96 rounded",alt:"..."}),(0,t.jsx)(c(),{src:o,className:"max-w-96 rounded",alt:"..."}),(0,t.jsx)(c(),{src:o,className:"max-w-96 rounded",alt:"..."})]})}),(0,t.jsx)(c(),{src:m,alt:"오른쪽 화살표",onClick:()=>{s(l=>l<e.subscribers.length-5?l+1:l),console.log(l)},className:"w-1/18"})]})})]})})}var g=s(2173),f={src:"/_next/static/media/piggie.bfe12cd4.svg",height:49,width:50,blurWidth:0,blurHeight:0};function A(e){return(0,t.jsxs)("div",{className:"flex flex-row justify-between ",children:[(0,t.jsx)(c(),{alt:"역할 사진",src:e.img,className:"mr-10 "}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-400",children:e.name}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-400",children:e.actor})]})]})}let b=[{img:f,name:"첫째 돼지",actor:""},{img:f,name:"첫째 돼지",actor:""},{img:f,name:"첫째 돼지",actor:""},{img:f,name:"첫째 돼지",actor:""},{img:f,name:"첫째 돼지",actor:""},{img:f,name:"첫째 돼지",actor:""}];function j(){return(0,t.jsxs)("div",{className:"h-3/5 rounded-md bg-white mb-5 p-5",children:[(0,t.jsx)("div",{children:(0,t.jsx)("h1",{className:"p-5",children:"연극 대본 고르기"})}),(0,t.jsx)("div",{className:" overflow-auto scroll-auto p-5 h-4/5 ",children:b.map((e,l)=>(0,t.jsx)(A,{img:e.img,name:e.name,actor:e.actor},l))})]})}function p(e){return(0,t.jsx)("div",{className:" ",children:(0,t.jsx)("div",{className:"rounded-md p-3 bg-gray",children:(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-400",children:e.name})})})}let w=[{name:"신데렐라"},{name:"엄마"},{name:"마법사"},{name:"왕"},{name:"왕자"}];function v(e){let[l,s]=(0,n.useState)([]),[r,a]=(0,n.useState)(Array(l.length).fill(l[0])),[i,c]=(0,n.useState)([...l]);return(0,n.useEffect)(()=>{s(e.ENTRY.map(e=>({name:e.name,isSelected:!1})))},[e.ENTRY]),(0,t.jsxs)("div",{className:"h-2/5  bg-white rounded-md mb-5 p-5",children:[(0,t.jsx)("div",{children:(0,t.jsx)("h1",{children:"역할 정하기"})}),(0,t.jsx)("div",{className:" overflow-auto scroll-auto p-5 h-4/5 ",children:w.map((r,a)=>(0,t.jsxs)("span",{className:"flex justify-between",children:[(0,t.jsx)(p,{name:r.name},a),(0,t.jsxs)("select",{className:" border text-sm rounded-lg block w-1/3 p-2.5 ",id:"roleSelect_".concat(a),onChange:t=>{!function(t,r){if(l[r].isSelected){alert("이미 선택된 친구에요");return}s(function(e){return e.map((e,l)=>(l===r&&(e.isSelected=!0),e))});let a={code:300,name:l[r].name,role:t};e.client.publish({destination:"/sub/channel/".concat(e.roomId),body:JSON.stringify(a)})}(r.name,Number(t.target.value))},children:[(0,t.jsx)("option",{selected:!0,children:"아이를 선택하세요"}),l.map((e,l)=>(0,t.jsx)("option",{className:e.isSelected?"bg-gray-500":"",value:l,disabled:e.isSelected,children:e.name},l))]})]},a))})]})}function N(e){return(0,t.jsxs)("div",{className:"h-[55rem] my-auto",children:[(0,t.jsx)(v,{ENTRY:e.ENTRY,client:e.client,roomId:e.roomId}),(0,t.jsx)(j,{})]})}function y(e){return(0,t.jsx)("div",{className:"col-span-3 ",children:(0,t.jsxs)("div",{className:"w-11/12 mx-auto h-full flex flex-col justify-between",children:[e.streamManager?(0,t.jsx)(x,{streamManager:e.streamManager}):(0,t.jsx)("div",{className:"mx-auto my-5 h-full",children:(0,t.jsx)("video",{controls:!0,muted:!0,className:"h-full",children:(0,t.jsx)("source",{src:"https://mongo-jelly.s3.ap-northeast-2.amazonaws.com/frontSampleVideo.mp4",type:"video/mp4"})})}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{id:"leftbox",className:"flex flex-row",children:[(0,t.jsx)("button",{type:"button",className:"h-14   text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"}),(0,t.jsx)("button",{type:"button",className:"text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"})]}),(0,t.jsxs)("div",{id:"rightbox",className:"flex flex-row ",children:[(0,t.jsx)("button",{type:"button",className:"text-white bg-blue-700 hover:bg-blue-800 focus:bg-blue-800 font-medium rounded-full text-xl px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:bg-blue-800",children:"종료하기"}),(0,t.jsx)("button",{type:"button",onClick:function(){e.client.publish({destination:"/sub/channel/".concat(e.roomId),body:JSON.stringify({code:400})})},className:"text-white bg-blue-700 hover:bg-blue-800 focus:bg-blue-800 font-medium rounded-full text-xl px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:bg-blue-800",children:"시작하기"})]})]})]})})}var E={src:"/_next/static/media/BasicUser.d3155757.svg",height:57,width:57,blurWidth:0,blurHeight:0};let S=[{src:"/_next/static/media/status201.32fc4db4.svg",height:121,width:118,blurWidth:0,blurHeight:0},{src:"/_next/static/media/status202.c37e1366.svg",height:126,width:84,blurWidth:0,blurHeight:0},{src:"/_next/static/media/status203.e67f2467.svg",height:101,width:111,blurWidth:0,blurHeight:0},{src:"/_next/static/media/status204.3fa83de2.svg",height:153,width:149,blurWidth:0,blurHeight:0}];function k(e){return console.log(e.ENTRY),(0,t.jsx)("div",{className:" rounded-md bg-white mb-5 p-5 h-full",children:(0,t.jsx)("div",{className:"max-w-md divide-y divide-gray-200 ",children:e.ENTRY.map((e,l)=>(0,t.jsx)("div",{className:"py-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4 rtl:space-x-reverse justify-between",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex",children:(0,t.jsx)(c(),{src:E,alt:"프로필 사진",className:"h-[5rem] w-[5rem] "})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("p",{className:"text-wrap",children:e.name}),(0,t.jsx)("p",{className:"text-left",children:e.role?e.role:"아직 역할이 없어요"})]}),e.status?(0,t.jsx)("div",{children:(0,t.jsx)(c(),{src:S[e.status-201],alt:"상태사진",className:"h-[5rem] w-[5rem]"})}):(0,t.jsx)("span",{className:"h-[5rem] w-[5rem]"})]})},l))})})}function C(e){return(0,t.jsx)("div",{className:"bottomcontainer",children:(0,t.jsxs)("div",{className:"grid grid-cols-5",children:[(0,t.jsx)(N,{ENTRY:e.ENTRY,client:e.client,roomId:e.roomId}),(0,t.jsx)(y,{client:e.client,roomId:e.roomId,streamManager:e.streamManager}),(0,t.jsx)(k,{ENTRY:e.ENTRY})]})})}function I(e){function l(l){let s={code:l,id:e.userId};e.client.publish({destination:"/sub/channel/".concat(e.roomId),body:JSON.stringify(s)})}return console.log("UserActionSection",e.role),(0,t.jsxs)("div",{className:" ml-[7rem] mr-[2rem] mt-[2rem] w-[60rem]",children:[(0,t.jsxs)("div",{className:"flex flex-row h-[8rem]  my-[2rem] ml-[2rem] ",children:[(0,t.jsx)(c(),{src:f,alt:"배역사진",className:"h-[8rem] w-[8rem] object-cover mr-[6rem]"}),(0,t.jsx)("div",{className:"inline-block my-auto mr-[6rem]",children:(0,t.jsxs)("div",{className:"inline-block ",children:[(0,t.jsx)("h1",{className:"block text-4xl",children:"나의 역할은"}),e.role?(0,t.jsxs)("h2",{className:"block text-5xl",children:[" ",(0,t.jsx)("strong",{className:"text-6xl",children:e.role}),"에요"]}):(0,t.jsx)("h2",{className:"block text-4xl",children:"아직 정해지지 않았어요"})]})}),(0,t.jsx)("div",{className:" h-[8rem] block relative ",children:(0,t.jsxs)("div",{id:"rightbox",className:"flex flex-row absolute bottom-0 z-2",children:[(0,t.jsx)("button",{type:"button",className:"w-[7rem] h-[4rem] text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"}),(0,t.jsx)("button",{type:"button",className:" w-[7rem] h-[4rem] text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-[1rem] mu-[2rem] h-[35rem] w-[55rem]",children:[(0,t.jsxs)("div",{onClick:()=>l(201),className:" hover:bg-gray-300  flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem]",children:[(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"선생님"}),(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"할 말 있어요"})]}),(0,t.jsxs)("div",{onClick:()=>l(202),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem]",children:[(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"화장실에 "}),(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"가고 싶어요"})]}),(0,t.jsxs)("div",{onClick:()=>l(203),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem]",children:[(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"저는"}),(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"준비됐어요"})]}),(0,t.jsxs)("div",{onClick:()=>l(204),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem]",children:[(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"응급 상황! "}),(0,t.jsx)("p",{className:"text-5xl w-[20rem] wrap text-center",children:"확인해 주세요"})]})]})]})}function z(){return(0,t.jsxs)("div",{className:"ml-[7rem] mt-[2rem] w-[68rem]",children:[(0,t.jsx)("h1",{className:"text-6xl text-center my-[1rem]",children:" 우리 선생님 화면 "}),(0,t.jsx)(c(),{alt:"메인화면",src:o,className:"h-[42rem]"})]})}function R(e){return(0,t.jsx)("div",{className:"bottomcontainer bg-white ",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-[1rem]",children:[(0,t.jsx)(z,{}),(0,t.jsx)(I,{client:e.client,roomId:e.roomId,userId:e.userId,role:e.role})]})})}var O=s(6672),T=s.n(O);let B={scene:[{sequence:1,title:"가족집",dialogs:[{img:"",role:"신데렐라",dialog:"안녕하세요, 제 이름은 신데렐라에요!"},{img:"",role:"엄마",dialog:"신데렐라, 일 좀 해봐. 청소 좀 해!"},{img:"",role:"신데렐라",dialog:"네, 엄마. 하지만 저 오늘은 왕궁에서 열리는 무도회에 가고 싶어요."},{img:"",role:"엄마",dialog:"무도회? 니가 그런 곳에 가면 안 돼. 청소 좀 해봐!"}]},{sequence:2,title:"마법사 출현",dialogs:[{img:"",role:"마법사",dialog:"안녕, 신데렐라. 내 마법 지팡이로 네 소원을 들어주마!"},{img:"",role:"신데렐라",dialog:"정말요? 그럼 제발 무도회에 가고 싶어요!"},{img:"",role:"마법사",dialog:"좋아, 그럼 너는 저 들려라! 밤 12시가 되면 돌아와야 해!"}]},{sequence:3,title:"왕궁 무도회",dialogs:[{img:"",role:"왕",dialog:"신데렐라, 네가 진짜 예쁘다!"},{img:"",role:"왕자",dialog:"나와 춤춰줄래?"}]},{sequence:4,title:"밤 12시",dialogs:[{img:"",role:"신데렐라",dialog:"아이고, 벌써 12시! 돌아가야 해요!"}]},{sequence:5,title:"가족집으로 돌아오는 신데렐라",dialogs:[{img:"",role:"신데렐라",dialog:"그래도 너무 행복한 하루였어요."},{img:"",role:"엄마",dialog:"넌 어디서 왔어? 무도회에서 늦게까지 뭐 하는 거야?"},{img:"",role:"신데렐라",dialog:"아, 그런데 12시에 돌아와야 했는데… (아쉬움)"}]},{sequence:6,title:"왕궁",dialogs:[{img:"",role:"왕",dialog:"이 유리 구두의 주인과 결혼하겠다!"},{img:"",role:"왕자",dialog:"그럼 이 구두의 주인은 바로 나의 신데렐라야!"},{img:"",role:"신데렐라",dialog:"아쉽게도 12시에 돌아가야 해요..."}]}],title:"신데렐라 연극",duration:"약 10분",thumbnail:"",person:5,roles:[{img:"",role:"신데렐라"},{img:"",role:"엄마"},{img:"",role:"마법사"},{img:"",role:"왕"},{img:"",role:"왕자"}]},D=B.scene.length,Q=B.scene.map(e=>e.dialogs.length),Y=()=>{let[e,l]=(0,n.useState)({scene:0,dialog:0,idx:0}),s=(0,n.useRef)([]);return{script:B,curIdx:e,refs:s,moveScript:function(){e.dialog<Q[e.scene]-1?l(e=>({...e,dialog:e.dialog+1,idx:e.idx+1})):e.scene<D-1&&l({scene:e.scene+1,dialog:0,idx:e.idx+1}),function(){if(s.current.length>0){var l;null===(l=s.current[e.idx])||void 0===l||l.scrollIntoView({behavior:"smooth",block:"center"})}}()}}};var M=s(717),H=s(3974),_=s(2597),J=s(6542),V={src:"/_next/static/media/ForestJpeg.6b2076be.jpg",height:2350,width:3e3,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAAGAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABmhP/xAAWEAEBAQAAAAAAAAAAAAAAAAADAhL/2gAIAQEAAQUChcl//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAC/9oACAEDAQE/AXJf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Br//EABgQAAIDAAAAAAAAAAAAAAAAAAABITFR/9oACAEBAAY/AoV6f//EABcQAQEBAQAAAAAAAAAAAAAAAAExABH/2gAIAQEAAT8hJmTkO//aAAwDAQACAAMAAAAQC//EABURAQEAAAAAAAAAAAAAAAAAAABR/9oACAEDAQE/EIH/xAAWEQEBAQAAAAAAAAAAAAAAAAABADH/2gAIAQIBAT8QEG3/xAAXEAEBAQEAAAAAAAAAAAAAAAABETEA/9oACAEBAAE/EF91kiLuJJO//9k=",blurWidth:8,blurHeight:6};function q(e){let l=0,[s,r]=(0,n.useState)([]),{script:a,curIdx:i,refs:o,moveScript:d}=Y(),m=(e,l)=>{if(e===i.scene&&l===i.dialog)return"rounded-xl border-8 border-main font-semibold p-2"};return(0,n.useEffect)(()=>{let l=new Set;B.scene[i.scene].dialogs.forEach(e=>{l.add(e.role)}),console.log(l),r(e.ENTRY.filter(e=>l.has(e.role)))},[i.scene]),(0,t.jsxs)("div",{className:"flex h-3/5 w-full relative justify-between",children:[(0,t.jsxs)("div",{className:"bg-white m-4 h-full",children:[(0,t.jsxs)("div",{className:"flex items-center m-4",children:[(0,t.jsx)(c(),{src:M.Z,width:24,height:24,alt:"현재 연극 대본"}),(0,t.jsx)("p",{className:"text-3xl",children:"현재 연극 대본"})]}),(0,t.jsx)("div",{className:"overflow-auto w-[36rem] h-full  p-4",id:T().scroll,children:(0,t.jsx)("div",{children:a.scene.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"sticky top-0 text-lg bg-gray-100 p-2 my-2",children:"".concat(e.sequence,"번째 씬")}),e.dialogs.map((e,r)=>(0,t.jsxs)("div",{ref:e=>{o.current[l++]=e},className:"flex items-center py-2 ".concat(m(s,r)),children:[(0,t.jsx)("div",{className:"shrink-0 bg-gray-200 rounded-full size-12 m-2",children:e.img}),(0,t.jsx)("p",{className:"text-xl",children:"".concat(e.role,": ").concat(e.dialog)})]},r))]},s))})})]}),(0,t.jsxs)("div",{className:"w-3/5 h-full",children:[(0,t.jsxs)("div",{className:"w-full justify-center p-3 relative h-full",children:[(0,t.jsx)(c(),{src:V,alt:"배경화면",className:"object-fill w-full h-full"}),e.streamManager?(0,t.jsx)("div",{className:"absolute top-0 left-0 p-[3rem]  w-full h-full grid grid-cols-4 gap-4 flex",children:s.map((e,l)=>(0,t.jsx)("div",{className:"z-10 w-full self-end",children:(0,t.jsx)(u,{streamManager:e.camera})},l))}):(0,t.jsx)("div",{className:"absolute top-0 left-0 p-[3rem]  w-full h-full",children:(0,t.jsx)("video",{controls:!0,muted:!0,className:" z-10 w-[40rem] h-[30rem]",children:(0,t.jsx)("source",{src:"https://mongo-jelly.s3.ap-northeast-2.amazonaws.com/frontSampleVideo.mp4",type:"video/mp4",className:"z-10"})})})]}),(0,t.jsxs)("div",{className:"flex flex-row justify-between px-[5rem]",children:[(0,t.jsxs)("div",{id:"leftbox",className:"flex flex-row",children:[(0,t.jsx)("button",{type:"button",className:"text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"}),(0,t.jsx)("button",{type:"button",className:"text-white bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:focus:ring-yellow-900",children:"Yellow"}),(0,t.jsx)("button",{onClick:function(){e.client.publish({destination:"/sub/channel/".concat(e.roomId),body:JSON.stringify({code:500})}),d()},children:(0,t.jsx)(H.Z,{className:"size-20"})}),(0,t.jsx)("button",{children:(0,t.jsx)(_.Z,{className:"size-20"})}),(0,t.jsx)("button",{children:(0,t.jsx)(J.Z,{className:"size-20"})})]}),(0,t.jsx)("div",{className:"flex flex-row"}),(0,t.jsxs)("div",{id:"rightbox",className:"flex flex-row ",children:[(0,t.jsx)("button",{type:"button",className:"text-white bg-blue-700 hover:bg-blue-800 focus:bg-blue-800 font-medium rounded-full text-xl px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:bg-blue-800",children:"종료하기"}),(0,t.jsx)("button",{type:"button",className:"text-white bg-blue-700 hover:bg-blue-800 focus:bg-blue-800 font-medium rounded-full text-xl px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:bg-blue-800",children:"시작하기"})]})]})]}),(0,t.jsx)("div",{className:"w-1/5 h-full",children:(0,t.jsx)(k,{ENTRY:e.ENTRY})})]})}var W=s(27),L=s(3085),U=s.n(L),F=s(2746),Z=s(1065),P=s.n(Z);let G={scene:[{sequence:1,title:"가족집",dialogs:[{img:"",role:"신데렐라",dialog:"안녕하세요, 제 이름은 신데렐라에요!"},{img:"",role:"엄마",dialog:"신데렐라, 일 좀 해봐. 청소 좀 해!"},{img:"",role:"신데렐라",dialog:"네, 엄마. 하지만 저 오늘은 왕궁에서 열리는 무도회에 가고 싶어요."},{img:"",role:"엄마",dialog:"무도회? 니가 그런 곳에 가면 안 돼. 청소 좀 해봐!"}]},{sequence:2,title:"마법사 출현",dialogs:[{img:"",role:"마법사",dialog:"안녕, 신데렐라. 내 마법 지팡이로 네 소원을 들어주마!"},{img:"",role:"신데렐라",dialog:"정말요? 그럼 제발 무도회에 가고 싶어요!"},{img:"",role:"마법사",dialog:"좋아, 그럼 너는 저 들려라! 밤 12시가 되면 돌아와야 해!"}]},{sequence:3,title:"왕궁 무도회",dialogs:[{img:"",role:"왕",dialog:"신데렐라, 네가 진짜 예쁘다!"},{img:"",role:"왕자",dialog:"나와 춤춰줄래?"}]},{sequence:4,title:"밤 12시",dialogs:[{img:"",role:"신데렐라",dialog:"아이고, 벌써 12시! 돌아가야 해요!"}]},{sequence:5,title:"가족집으로 돌아오는 신데렐라",dialogs:[{img:"",role:"신데렐라",dialog:"그래도 너무 행복한 하루였어요."},{img:"",role:"엄마",dialog:"넌 어디서 왔어? 무도회에서 늦게까지 뭐 하는 거야?"},{img:"",role:"신데렐라",dialog:"아, 그런데 12시에 돌아와야 했는데… (아쉬움)"}]},{sequence:6,title:"왕궁",dialogs:[{img:"",role:"왕",dialog:"이 유리 구두의 주인과 결혼하겠다!"},{img:"",role:"왕자",dialog:"그럼 이 구두의 주인은 바로 나의 신데렐라야!"},{img:"",role:"신데렐라",dialog:"아쉽게도 12시에 돌아가야 해요..."}]}],title:"신데렐라 연극",duration:"약 10분",thumbnail:"",person:5,roles:[{img:"",role:"신데렐라"},{img:"",role:"엄마"},{img:"",role:"마법사"},{img:"",role:"왕"},{img:"",role:"왕자"}]},X=G.scene.length,K=G.scene.map(e=>e.dialogs.length),$=()=>{let[e,l]=(0,n.useState)({scene:0,dialog:0,idx:0}),s=(0,n.useRef)([]);return{script:G,curIdx:e,refs:s,moveScript:function(){e.dialog<K[e.scene]-1?l(e=>({...e,dialog:e.dialog+1,idx:e.idx+1})):e.scene<X-1&&l({scene:e.scene+1,dialog:0,idx:e.idx+1}),function(){if(s.current.length>0){var l;null===(l=s.current[e.idx])||void 0===l||l.scrollIntoView({behavior:"smooth",block:"center"})}}()}}};function ee(e){let l=0,[s,r]=(0,n.useState)([]),{script:a,curIdx:i,refs:o,moveScript:d}=$(),m=(e,l)=>{if(e===i.scene&&l===i.dialog)return"rounded-xl border-8 border-main font-semibold p-2"};function x(l){let s={code:l,id:e.userId};e.client.publish({destination:"/sub/channel/".concat(e.roomId),body:JSON.stringify(s)})}return(0,n.useEffect)(()=>{let l=new Set;G.scene[i.scene].dialogs.forEach(e=>{l.add(e.role)}),console.log(l),r(e.ENTRY.filter(e=>l.has(e.role))),console.log(e.ENTRY,s)},[i.scene]),(0,n.useEffect)(()=>{e.goNext&&d()},[e.goNext]),(0,t.jsxs)("div",{className:"flex h-full w-full relative justify-between px-[5rem]",children:[(0,t.jsxs)("div",{className:"bg-white m-4 h-4/5",children:[(0,t.jsxs)("div",{className:"flex items-center m-4",children:[(0,t.jsx)(c(),{src:M.Z,width:24,height:24,alt:"현재 연극 대본"}),(0,t.jsx)("p",{className:"text-3xl",children:"현재 연극 대본"})]}),(0,t.jsx)("div",{className:"overflow-auto w-[36rem] h-full  p-4",id:P().scroll,children:(0,t.jsx)("div",{children:a.scene.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"sticky top-0 text-lg bg-gray-100 p-2 my-2",children:"".concat(e.sequence,"번째 씬")}),e.dialogs.map((e,r)=>(0,t.jsxs)("div",{ref:e=>{o.current[l++]=e},className:"flex items-center py-2 ".concat(m(s,r)),children:[(0,t.jsx)("div",{className:"shrink-0 bg-gray-200 rounded-full size-12 m-2",children:e.img}),(0,t.jsx)("p",{className:"text-xl",children:"".concat(e.role,": ").concat(e.dialog)})]},r))]},s))})})]}),(0,t.jsxs)("div",{className:"w-3/5 h-full",children:[(0,t.jsxs)("div",{className:"w-full h-4/5 justify-center p-3 relative ",children:[(0,t.jsx)(c(),{src:V,alt:"배경화면",className:"object-fill w-full h-full"}),e.streamManager?(0,t.jsx)("div",{className:"absolute top-0 left-0 p-[3rem]  w-full h-full grid grid-cols-4 gap-4 flex",children:s.map((e,l)=>(0,t.jsx)("div",{className:"z-10 w-full self-end",children:(0,t.jsx)(u,{streamManager:e.camera})},l))}):(0,t.jsx)("div",{className:"absolute top-0 left-0 p-[3rem]  w-full h-full",children:(0,t.jsx)("video",{controls:!0,muted:!0,className:" z-10 w-[40rem] h-[30rem]",children:(0,t.jsx)("source",{src:"https://mongo-jelly.s3.ap-northeast-2.amazonaws.com/frontSampleVideo.mp4",type:"video/mp4",className:"z-10"})})})]}),(0,t.jsx)("div",{className:"flex justify-center items-center bg-white w-full h-1/5  p-3 default-component-color",children:(0,t.jsx)("p",{className:"text-3xl",children:a.scene[i.scene].dialogs[i.dialog].dialog})})]}),(0,t.jsx)("div",{className:"w-1/5 h-4/5",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 mu-[2rem] h-full w-full",children:[(0,t.jsxs)("div",{onClick:()=>x(201),className:" hover:bg-gray-300 default-component-color flex flex-col justify-center items-center h-[calc(50% - 1rem)]  ml-[0.5rem] mt-[0.5rem] rounded-[2rem] p-[3rem]",children:[(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"선생님"}),(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"할 말 있어요"})]}),(0,t.jsxs)("div",{onClick:()=>x(202),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem] p-[3rem]",children:[(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"화장실에 "}),(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"가고 싶어요"})]}),(0,t.jsxs)("div",{onClick:()=>x(203),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem] p-[3rem]",children:[(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"저는"}),(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"준비됐어요"})]}),(0,t.jsxs)("div",{onClick:()=>x(204),className:"  hover:bg-gray-300 flex flex-col justify-center items-center h-[calc(50% - 1rem)] default-component-color ml-[0.5rem] mt-[0.5rem] rounded-[2rem] p-[3rem]",children:[(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"응급 상황! "}),(0,t.jsx)("p",{className:"text-5xl wrap text-center",children:"확인해 주세요"})]})]})})]})}function el(e){let{params:{roomId:l}}=e,[s,r]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),[o,d]=(0,n.useState)([]),[m,u]=(0,n.useState)("Participant".concat(Math.floor(100*Math.random()))),[x,f]=(0,n.useState)(void 0),[A,b]=(0,n.useState)(void 0),[j,p]=(0,n.useState)([]),[w,v]=(0,n.useState)(void 0),[N,y]=(0,n.useState)(null),[E,S]=(0,n.useState)(""),[k,I]=(0,n.useState)(""),[z,O]=(0,n.useState)(!1),[T,B]=(0,n.useState)(!1),[D,Q]=(0,n.useState)(!1),Y=(0,n.useRef)(!1),[M,H]=(0,n.useState)(0),_=(0,n.useRef)({}),J=(0,n.useRef)(new F.OpenVidu);function V(e){try{let l=JSON.parse(e.body);100==l.code?d(e=>{let s=[];return void 0===e.find(e=>e.name===l.id)&&(s=[{name:l.id,status:0,role:"",camera:null}].concat(e)),s}):101==l.code?(l.videoid,d(e=>e.filter(e=>e.name!=l.id))):200<=l.code&&l.code<300?(d(e=>e.map(e=>(e.name===l.id&&(e.status=l.code),e))),I(l.id),d(e=>{let s=[];if(e.find(e=>e.name===l.id)){let t=e.find(e=>e.name===l.id);t&&(t.status=l.code,s=[t].concat(e.filter(e=>e.name!=l.id)))}else s=e;return s})):300===Number(l.code)?(d(e=>(e[e.findIndex(e=>e.name==l.name)].role=l.role,e.map(e=>e))),Y.current||m!==l.name||S(l.role)):400===l.code?(O(!0),setTimeout(()=>{B(!0),setTimeout(()=>{Q(!0),setTimeout(()=>{O(!1),B(!1),Q(!1),c(!0)},5e3)},2e3)},1e3)):500===l.code&&H(e=>e>8?1:e+1)}catch(e){console.error("Error parsing received message:",e)}}let L=async e=>(await g.Z.post("/openvidu/api/sessions/".concat(e,"/connection "),{headers:{Authorization:"Basic T1BFTlZJRFVBUFA6bWFuZ28=","Content-Type":"application/json"}})).data;return(0,n.useEffect)(()=>{let e=J.current.initSession();e.on("streamCreated",l=>{let s=JSON.parse(l.stream.inboundStreamOpts.connection.data),t=e.subscribe(l.stream,void 0),r={userId:s.clientData,Subscriber:t};s.clientData!==m&&(p(e=>[...e,r]),d(e=>{let l=[];if(void 0!==e.find(e=>e.name===s.clientData)){let r=e.find(e=>e.name===s.clientData);r&&(r.camera=t,l=[r].concat(e.filter(e=>e.name!==s.clientData)))}else l=[{name:s.clientData,status:0,role:"",camera:t}].concat(e);return l}))}),e.on("exception",e=>{console.warn(e)}),window.addEventListener("beforeunload",t),window.addEventListener("beforeunload",()=>{e.disconnect()}),L(l).then(async l=>{try{await e.connect(l.token,{clientData:m});let s=await J.current.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!1,publishVideo:!0,resolution:"1280x720",frameRate:30,insertMode:"APPEND",mirror:!1});e.publish(s);let t=(await J.current.getDevices()).filter(e=>"videoinput"===e.kind),r=s.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId,a=t.find(e=>e.deviceId===r);f(s),v(s),y(a)}catch(e){console.log("There was an error connecting to the session:",e.code,e.message)}});let s=()=>{_.current.subscribe("/sub/channel/".concat(l),V)};function t(){_.current.publish({destination:"/sub/channel/".concat(l),body:JSON.stringify({code:101,id:m,videoid:"".concat(m)})})}_.current=W.L.over(function(){return new(U())("https://mangotail.shop/ws")}),_.current.onConnect=()=>{s(),_.current.publish({destination:"/sub/channel/".concat(l),body:JSON.stringify({code:100,id:m,videoid:"".concat(m)})})},_.current.onDisconnect=()=>{t()},_.current.activate()},[m,l]),(0,t.jsxs)("div",{className:"flex flex-col items-center px-[15rem] h-lvh ",children:[z?(0,t.jsx)("div",{className:"fadeoutcomponent",style:{opacity:T?1:0},children:D?(0,t.jsx)("video",{className:"w-full h-full",controls:!0,autoPlay:!0,children:(0,t.jsx)("source",{src:".curtainsclosing.mp4",type:"video/mp4"})}):null}):null,(0,t.jsxs)("div",{className:"relative h-full w-full",children:[s||!i?(0,t.jsx)(h,{depart:"꿈나무 유치원",title:"망고 연극반",call:k,ENTRY:o,subscribers:j}):null,(0,t.jsx)("p",{className:"text-center",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{r(e=>!e),Y.current=!Y.current},className:"text-white bg-blue-700 hover:bg-blue-800 active:bg-blue-800   font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800",children:[s?"Host":"Guest","  "]})}),(0,t.jsxs)("div",{className:"relative h-full w-full",children:[s?i?(0,t.jsx)(q,{ENTRY:o,client:_.current,roomId:l,streamManager:x}):(0,t.jsx)(C,{ENTRY:o,client:_.current,roomId:l,streamManager:x}):null,s?null:i?(0,t.jsx)(ee,{client:_.current,userId:m||"",ENTRY:o,roomId:l,subscribers:j,streamManager:x,goNext:M}):(0,t.jsx)(R,{client:_.current,roomId:l,role:E,userId:m||""}),(0,t.jsx)(a(),{href:"/scenario/1",children:"링크"})]})]})]})}},832:function(){},1065:function(e){e.exports={scroll:"scrollbar_scroll__emU76"}},6672:function(e){e.exports={scroll:"scrollbar_scroll__WKuze"}},717:function(e,l){"use strict";l.Z={src:"/_next/static/media/CookieHouse.fc0af9b3.png",height:343,width:316,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAAb1BMVEXNqo2LZTutiV+RWinXqYVzbSbd08lMaXHWjFDbz8TbzsK3hVzOwLJ9UCiEdDPEfkvUnHLHjl7Osp6EcEzVysDDnn98USmpim/CuK64imC4knPlupfdn2/OmW3Zu6Sod07kq4Gph0dOZBTCkmrn29GRIO2pAAAAHHRSTlP+1Zap/f7RAP78eu1JfvrXnNnwTZ/+vvj94Lj93zg33wAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAEFJREFUeJwFwQUCwCAMBLDD2xlzLUz//8YlCGHE7jVCweshChVjYjHwmQjfhv4mSXlB6xqLd4Z+3GWTwaBiV571D2OSA1OqRaamAAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8}}},function(e){e.O(0,[749,580,250,870,971,938,744],function(){return e(e.s=3934)}),_N_E=e.O()}]);